{"ast":null,"code":"var _jsxFileName = \"/workspaces/v4/src/contexts/JWTAuth.jsx\",\n  _s = $RefreshSig$();\nimport LoadingScreen from \"components/LoadingScreen\";\nimport jwtDecode from \"jwt-decode\";\nimport { createContext, useEffect, useReducer } from \"react\";\nimport axios from \"../utils/axios\"; // --------------------------------------------------------\n\n// --------------------------------------------------------\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst initialState = {\n  isAuthenticated: boolean,\n  isInitialized: boolean,\n  user: AuthUser\n};\nconst isValidToken = accessToken => {\n  if (!accessToken) return false;\n  const decodedToken = jwtDecode(accessToken);\n  const currentTime = Date.now() / 1000;\n  return decodedToken.exp > currentTime;\n};\nconst setSession = accessToken => {\n  if (accessToken) {\n    // localStorage.setItem('accessToken', accessToken);\n    axios.defaults.headers.common.Authorization = `Bearer ${accessToken}`;\n  } else {\n    // localStorage.removeItem('accessToken');\n    delete axios.defaults.headers.common.Authorization;\n  }\n};\nconst reducer = (state, action) => {\n  switch (action.type) {\n    case \"INIT\":\n      {\n        return {\n          isInitialized: true,\n          user: action.payload.user,\n          isAuthenticated: action.payload.isAuthenticated\n        };\n      }\n    case \"LOGIN\":\n      {\n        return {\n          ...state,\n          isAuthenticated: true,\n          user: action.payload.user\n        };\n      }\n    case \"LOGOUT\":\n      {\n        return {\n          ...state,\n          user: null,\n          isAuthenticated: false\n        };\n      }\n    case \"REGISTER\":\n      {\n        return {\n          ...state,\n          isAuthenticated: false,\n          user: action.payload.user\n        };\n      }\n    default:\n      {\n        return state;\n      }\n  }\n};\nconst AuthContext = /*#__PURE__*/createContext({\n  ...initialState,\n  method: \"JWT\",\n  logout: () => {},\n  login: (email, password) => Promise.resolve(),\n  register: (email, password, username) => Promise.resolve()\n});\nexport const JWTAuthProvider = _ref => {\n  _s();\n  let {\n    children\n  } = _ref;\n  const [state, dispatch] = useReducer(reducer, initialState);\n  const login = async (email, password) => {\n    const {\n      data\n    } = await axios.post(\"/api/auth/login\", {\n      email,\n      password\n    });\n    setSession(data.accessToken);\n    dispatch({\n      type: \"LOGIN\",\n      payload: {\n        user: data.user\n      }\n    });\n  };\n  const register = async (email, username, password) => {\n    const {\n      data\n    } = await axios.post(\"/api/auth/register\", {\n      email,\n      username,\n      password\n    });\n    setSession(data.accessToken);\n    dispatch({\n      type: \"REGISTER\",\n      payload: {\n        user: data.user\n      }\n    });\n  };\n  const logout = () => {\n    setSession(null);\n    dispatch({\n      type: \"LOGOUT\"\n    });\n  };\n  useEffect(() => {\n    (async () => {\n      try {\n        const accessToken = localStorage.getItem(\"accessToken\");\n        if (accessToken && isValidToken(accessToken)) {\n          setSession(accessToken);\n          const {\n            data\n          } = await axios.get(\"/api/auth/profile\");\n          dispatch({\n            type: \"INIT\",\n            payload: {\n              user: data.user,\n              isAuthenticated: true\n            }\n          });\n        } else {\n          dispatch({\n            type: \"INIT\",\n            payload: {\n              user: null,\n              isAuthenticated: false\n            }\n          });\n        }\n      } catch (err) {\n        console.error(err);\n        dispatch({\n          type: \"INIT\",\n          payload: {\n            user: null,\n            isAuthenticated: false\n          }\n        });\n      }\n    })();\n  }, []); // show loading until not initialized\n\n  if (!state.isInitialized) /*#__PURE__*/_jsxDEV(LoadingScreen, {}, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 163,\n    columnNumber: 29\n  }, this);\n  return /*#__PURE__*/_jsxDEV(AuthContext.Provider, {\n    value: {\n      ...state,\n      method: \"JWT\",\n      login,\n      register,\n      logout\n    },\n    children: children\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 164,\n    columnNumber: 10\n  }, this);\n};\n_s(JWTAuthProvider, \"bgCdjuTOmPdSBRwTap80EFd9Y3U=\");\n_c = JWTAuthProvider;\nexport default AuthContext;\nvar _c;\n$RefreshReg$(_c, \"JWTAuthProvider\");","map":{"version":3,"names":["LoadingScreen","jwtDecode","createContext","useEffect","useReducer","axios","initialState","isAuthenticated","boolean","isInitialized","user","AuthUser","isValidToken","accessToken","decodedToken","currentTime","Date","now","exp","setSession","defaults","headers","common","Authorization","reducer","state","action","type","payload","AuthContext","method","logout","login","email","password","Promise","resolve","register","username","JWTAuthProvider","children","dispatch","data","post","localStorage","getItem","get","err","console","error"],"sources":["/workspaces/v4/src/contexts/JWTAuth.jsx"],"sourcesContent":["import LoadingScreen from \"components/LoadingScreen\";\nimport jwtDecode from \"jwt-decode\";\nimport { createContext, useEffect, useReducer } from \"react\";\nimport axios from \"../utils/axios\"; // --------------------------------------------------------\n\n// --------------------------------------------------------\n\nconst initialState = {\n  isAuthenticated: boolean,\n  isInitialized: boolean,\n  user: AuthUser\n};\n\nconst isValidToken = accessToken => {\n  if (!accessToken) return false;\n  const decodedToken = jwtDecode(accessToken);\n  const currentTime = Date.now() / 1000;\n  return decodedToken.exp > currentTime;\n};\n\nconst setSession = accessToken => {\n  if (accessToken) {\n    // localStorage.setItem('accessToken', accessToken);\n    axios.defaults.headers.common.Authorization = `Bearer ${accessToken}`;\n  } else {\n    // localStorage.removeItem('accessToken');\n    delete axios.defaults.headers.common.Authorization;\n  }\n};\n\nconst reducer = (state, action) => {\n  switch (action.type) {\n    case \"INIT\":\n      {\n        return {\n          isInitialized: true,\n          user: action.payload.user,\n          isAuthenticated: action.payload.isAuthenticated\n        };\n      }\n\n    case \"LOGIN\":\n      {\n        return { ...state,\n          isAuthenticated: true,\n          user: action.payload.user\n        };\n      }\n\n    case \"LOGOUT\":\n      {\n        return { ...state,\n          user: null,\n          isAuthenticated: false\n        };\n      }\n\n    case \"REGISTER\":\n      {\n        return { ...state,\n          isAuthenticated: false,\n          user: action.payload.user\n        };\n      }\n\n    default:\n      {\n        return state;\n      }\n  }\n};\n\nconst AuthContext = createContext({ ...initialState,\n  method: \"JWT\",\n  logout: () => {},\n  login: (email, password) => Promise.resolve(),\n  register: (email, password, username) => Promise.resolve()\n});\nexport const JWTAuthProvider = ({\n  children\n}) => {\n  const [state, dispatch] = useReducer(reducer, initialState);\n\n  const login = async (email, password) => {\n    const {\n      data\n    } = await axios.post(\"/api/auth/login\", {\n      email,\n      password\n    });\n    setSession(data.accessToken);\n    dispatch({\n      type: \"LOGIN\",\n      payload: {\n        user: data.user\n      }\n    });\n  };\n\n  const register = async (email, username, password) => {\n    const {\n      data\n    } = await axios.post(\"/api/auth/register\", {\n      email,\n      username,\n      password\n    });\n    setSession(data.accessToken);\n    dispatch({\n      type: \"REGISTER\",\n      payload: {\n        user: data.user\n      }\n    });\n  };\n\n  const logout = () => {\n    setSession(null);\n    dispatch({\n      type: \"LOGOUT\"\n    });\n  };\n\n  useEffect(() => {\n    (async () => {\n      try {\n        const accessToken = localStorage.getItem(\"accessToken\");\n\n        if (accessToken && isValidToken(accessToken)) {\n          setSession(accessToken);\n          const {\n            data\n          } = await axios.get(\"/api/auth/profile\");\n          dispatch({\n            type: \"INIT\",\n            payload: {\n              user: data.user,\n              isAuthenticated: true\n            }\n          });\n        } else {\n          dispatch({\n            type: \"INIT\",\n            payload: {\n              user: null,\n              isAuthenticated: false\n            }\n          });\n        }\n      } catch (err) {\n        console.error(err);\n        dispatch({\n          type: \"INIT\",\n          payload: {\n            user: null,\n            isAuthenticated: false\n          }\n        });\n      }\n    })();\n  }, []); // show loading until not initialized\n\n  if (!state.isInitialized) <LoadingScreen />;\n  return <AuthContext.Provider value={{ ...state,\n    method: \"JWT\",\n    login,\n    register,\n    logout\n  }}>\n      {children}\n    </AuthContext.Provider>;\n};\nexport default AuthContext;"],"mappings":"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"},"metadata":{},"sourceType":"module"}