{"ast":null,"code":"var _jsxFileName = \"/workspaces/v4/client/src/contexts/JWTAuth.jsx\",\n  _s = $RefreshSig$();\nimport LoadingScreen from \"components/LoadingScreen\";\nimport jwtDecode from \"jwt-decode\";\nimport { createContext, useEffect, useReducer } from \"react\";\nimport axios from \"utils/axios\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst initialState = {\n  isAuthenticated: false,\n  isInitialized: false,\n  user: null\n};\nconst isValidToken = accessToken => {\n  if (!accessToken) return false;\n  const decodedToken = jwtDecode(accessToken);\n  const currentTime = Date.now() / 1000;\n  return decodedToken.exp > currentTime;\n};\nconst setSession = accessToken => {\n  if (accessToken) {\n    localStorage.setItem(\"accessToken\", accessToken);\n    axios.defaults.headers.common.Authorization = `Bearer ${accessToken}`;\n  } else {\n    localStorage.removeItem(\"accessToken\");\n    delete axios.defaults.headers.common.Authorization;\n  }\n};\nconst reducer = (state, action) => {\n  switch (action.type) {\n    case \"INIT\":\n      return {\n        isInitialized: true,\n        user: action.payload.user,\n        isAuthenticated: action.payload.isAuthenticated\n      };\n    case \"LOGIN\":\n      return {\n        ...state,\n        isAuthenticated: true,\n        user: action.payload.user\n      };\n    case \"LOGOUT\":\n      return {\n        ...state,\n        user: null,\n        isAuthenticated: false\n      };\n    case \"REGISTER\":\n      return {\n        ...state,\n        isAuthenticated: false,\n        user: action.payload.user\n      };\n    default:\n      return state;\n  }\n};\nconst AuthContext = /*#__PURE__*/createContext({\n  ...initialState,\n  method: \"JWT\",\n  login: (email, password) => Promise.resolve(),\n  logout: () => {},\n  register: (username, email, password, userType) => Promise.resolve()\n});\nexport const JWTAuthProvider = _ref => {\n  _s();\n  let {\n    children\n  } = _ref;\n  const [state, dispatch] = useReducer(reducer, initialState);\n  const login = async (email, password) => {\n    const {\n      data\n    } = await axios.post(\"/api/auth/login\", {\n      email,\n      password\n    });\n    setSession(data.accessToken);\n    dispatch({\n      type: \"LOGIN\",\n      payload: {\n        user: data.user\n      }\n    });\n  };\n  const register = async (username, email, password, userType) => {\n    const {\n      data\n    } = await axios.post(\"/api/auth/login\", {\n      username,\n      email,\n      password,\n      userType\n    });\n    setSession(data.accessToken);\n    dispatch({\n      type: \"REGISTER\",\n      payload: {\n        user: data.user\n      }\n    });\n  };\n  const logout = () => {\n    setSession(null);\n    dispatch({\n      type: \"LOGOUT\"\n    });\n  };\n  useEffect(() => {\n    (async () => {\n      try {\n        const accessToken = localStorage.getItem(\"accessToken\");\n        if (accessToken && isValidToken(accessToken)) {\n          setSession(accessToken);\n          const {\n            data\n          } = await axios.get(\"/api/auth/profile\");\n          dispatch({\n            type: \"INIT\",\n            payload: {\n              user: data.user,\n              isAuthenticated: true\n            }\n          });\n        } else {\n          dispatch({\n            type: \"INIT\",\n            payload: {\n              user: null,\n              isAuthenticated: false\n            }\n          });\n        }\n      } catch (err) {\n        console.error(err);\n        dispatch({\n          type: \"INIT\",\n          payload: {\n            user: null,\n            isAuthenticated: false\n          }\n        });\n      }\n    })();\n  }, []);\n  if (!state.isInitialized) {\n    return /*#__PURE__*/_jsxDEV(LoadingScreen, {}, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 146,\n      columnNumber: 12\n    }, this);\n  }\n  return /*#__PURE__*/_jsxDEV(AuthContext.Provider, {\n    value: {\n      ...state,\n      method: \"JWT\",\n      login,\n      register,\n      logout\n    },\n    children: children\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 150,\n    columnNumber: 5\n  }, this);\n};\n_s(JWTAuthProvider, \"bgCdjuTOmPdSBRwTap80EFd9Y3U=\");\n_c = JWTAuthProvider;\nexport default AuthContext;\nvar _c;\n$RefreshReg$(_c, \"JWTAuthProvider\");","map":{"version":3,"names":["LoadingScreen","jwtDecode","createContext","useEffect","useReducer","axios","initialState","isAuthenticated","isInitialized","user","isValidToken","accessToken","decodedToken","currentTime","Date","now","exp","setSession","localStorage","setItem","defaults","headers","common","Authorization","removeItem","reducer","state","action","type","payload","AuthContext","method","login","email","password","Promise","resolve","logout","register","username","userType","JWTAuthProvider","children","dispatch","data","post","getItem","get","err","console","error"],"sources":["/workspaces/v4/client/src/contexts/JWTAuth.jsx"],"sourcesContent":["import LoadingScreen from \"components/LoadingScreen\";\nimport jwtDecode from \"jwt-decode\";\nimport { createContext, useEffect, useReducer } from \"react\";\nimport axios from \"utils/axios\";\n\nconst initialState = {\n  isAuthenticated: false,\n  isInitialized: false,\n  user: null,\n};\n\nconst isValidToken = (accessToken) => {\n  if (!accessToken) return false;\n  const decodedToken = jwtDecode(accessToken);\n  const currentTime = Date.now() / 1000;\n  return decodedToken.exp > currentTime;\n};\n\nconst setSession = (accessToken) => {\n  if (accessToken) {\n    localStorage.setItem(\"accessToken\", accessToken);\n    axios.defaults.headers.common.Authorization = `Bearer ${accessToken}`;\n  } else {\n    localStorage.removeItem(\"accessToken\");\n    delete axios.defaults.headers.common.Authorization;\n  }\n};\n\nconst reducer = (state, action) => {\n  switch (action.type) {\n    case \"INIT\":\n      return {\n        isInitialized: true,\n        user: action.payload.user,\n        isAuthenticated: action.payload.isAuthenticated,\n      };\n    case \"LOGIN\":\n      return {\n        ...state,\n        isAuthenticated: true,\n        user: action.payload.user,\n      };\n    case \"LOGOUT\":\n      return {\n        ...state,\n        user: null,\n        isAuthenticated: false,\n      };\n    case \"REGISTER\":\n      return {\n        ...state,\n        isAuthenticated: false,\n        user: action.payload.user,\n      };\n    default:\n      return state;\n  }\n};\n\nconst AuthContext = createContext({\n  ...initialState,\n  method: \"JWT\",\n  login: (email, password) => Promise.resolve(),\n  logout: () => {},\n  register: (username, email, password, userType) => Promise.resolve(),\n});\n\nexport const JWTAuthProvider = ({ children }) => {\n  const [state, dispatch] = useReducer(reducer, initialState);\n\n  const login = async (email, password) => {\n    const { data } = await axios.post(\"/api/auth/login\", {\n      email,\n      password,\n    });\n    setSession(data.accessToken);\n    dispatch({\n      type: \"LOGIN\",\n      payload: {\n        user: data.user,\n      },\n    });\n  };\n\n  const register = async (username, email, password , userType) => {\n    const { data } = await axios.post(\"/api/auth/login\", {\n      username,\n      email,\n      password,\n      userType,\n    });\n    setSession(data.accessToken);\n    dispatch({\n      type: \"REGISTER\",\n      payload: {\n        user: data.user,\n      },\n    });\n  };\n\n  const logout = () => {\n    setSession(null);\n    dispatch({\n      type: \"LOGOUT\",\n    });\n  };\n\n  useEffect(() => {\n    (async () => {\n      try {\n        const accessToken = localStorage.getItem(\"accessToken\");\n\n        if (accessToken && isValidToken(accessToken)) {\n          setSession(accessToken);\n          const { data } = await axios.get(\"/api/auth/profile\");\n          dispatch({\n            type: \"INIT\",\n            payload: {\n              user: data.user,\n              isAuthenticated: true,\n            },\n          });\n        } else {\n          dispatch({\n            type: \"INIT\",\n            payload: {\n              user: null,\n              isAuthenticated: false,\n            },\n          });\n        }\n      } catch (err) {\n        console.error(err);\n        dispatch({\n          type: \"INIT\",\n          payload: {\n            user: null,\n            isAuthenticated: false,\n          },\n        });\n      }\n    })();\n  }, []);\n\n  if (!state.isInitialized) {\n    return <LoadingScreen />;\n  }\n\n  return (\n    <AuthContext.Provider\n      value={{\n        ...state,\n        method: \"JWT\",\n        login,\n        register,\n        logout,\n      }}\n    >\n      {children}\n    </AuthContext.Provider>\n  );\n};\n\nexport default AuthContext;\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}